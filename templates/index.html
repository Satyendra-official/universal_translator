<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Universal Translator</title>
    <link rel="stylesheet" href="../static/styles.css">
    <script>
        // Function to show and hide inputs based on the selected mode
        function toggleInputMode() {
            const inputMode = document.querySelector('input[name="input_mode"]:checked').value;
            document.getElementById('text_input').style.display = 'none';
            document.getElementById('audio_input').style.display = 'none';
            document.getElementById('video_input').style.display = 'none';
            if (inputMode === 'text') {
                document.getElementById('text_input').style.display = 'block';
            } else if (inputMode === 'audio') {
                document.getElementById('audio_input').style.display = 'block';
            } else if (inputMode === 'video') {
                document.getElementById('video_input').style.display = 'block';
            }
        }

        // Handle feedback submission
        function submitFeedback() {
            const inputText = document.getElementById('input_text').value;
            const translatedText = document.getElementById('translated_text').value;
            const expectedText = document.getElementById('expected_text').value;
            const context = document.getElementById('context').value;
            fetch('/feedback', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    input_text: inputText,
                    translated_text: translatedText,
                    expected: expectedText,
                    context: context
                })
            })
            .then(response => response.json())
            .then(data => alert('Feedback submitted!'))
            .catch(error => alert('Error submitting feedback: ' + error));
        }

        // Initialize the page
        window.onload = function() {
            toggleInputMode();
        };
    </script>
</head>
<body>
    <h2>Universal Translator üåê</h2>
    <form method="POST" enctype="multipart/form-data">
        <label>Select Input Mode:</label><br>
        <input type="radio" name="input_mode" value="text" checked onclick="toggleInputMode()"> Text
        <input type="radio" name="input_mode" value="audio" onclick="toggleInputMode()"> Audio
        <input type="radio" name="input_mode" value="video" onclick="toggleInputMode()"> Video<br><br>

        <!-- Text Input -->
        <div id="text_input">
            <textarea name="text" rows="4" cols="50" placeholder="Enter text to translate...">{{ request.form['text'] if request.form['input_mode'] == 'text' else '' }}</textarea><br><br>
        </div>

        <!-- Audio Input (file upload) -->
        <div id="audio_input" style="display:none;">
            <input type="file" name="audio_file" accept="audio/*"><br><br>
        </div>

        <!-- Video Input (file upload) -->
        <div id="video_input" style="display:none;">
            <input type="file" name="video_file" accept="video/*"><br><br>
        </div>

        <label>Target Language:</label>
        <select name="target_lang">
            {% for code, name in languages.items() %}
                <option value="{{ code }}" {% if code == request.form['target_lang'] %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select><br><br>

        <label>Translation Context:</label>
        <select name="context">
            <option value="general" {% if request.form['context'] == 'general' %}selected{% endif %}>General</option>
            <option value="formal" {% if request.form['context'] == 'formal' %}selected{% endif %}>Formal</option>
            <option value="informal" {% if request.form['context'] == 'informal' %}selected{% endif %}>Informal</option>
            <option value="theater" {% if request.form['context'] == 'theater' %}selected{% endif %}>Theater</option>
            <option value="business" {% if request.form['context'] == 'business' %}selected{% endif %}>Business</option>
        </select><br><br>

        <input type="submit" value="Translate">
    </form>

    {% if translated_text %}
        <div class="translated-content">
            <h3>Translation:</h3> 
            <p>{{ translated_text }}</p>
            {% if audio_file_path %}
                <h4>Translated Audio:</h4>
                <audio controls>
                    <source src="{{ url_for('static', filename='translated_audio.mp3') }}?v={{ timestamp }}" type="audio/mpeg">
                </audio>
            {% endif %}
            <h4>Report Translation Error:</h4>
            <form id="feedback_form" onsubmit="event.preventDefault(); submitFeedback();">
                <input type="hidden" id="input_text" value="{{ input_text }}">
                <input type="hidden" id="translated_text" value="{{ translated_text }}">
                <input type="hidden" id="context" value="{{ request.form.get('context', 'general') }}">
                <label>Expected Translation:</label><br>
                <textarea id="expected_text" rows="4" cols="50" placeholder="Enter the correct translation..."></textarea><br><br>
                <input type="submit" value="Submit Feedback">
            </form>
        </div>
    {% endif %}
</body>
</html>